## 유즈케이스

### 사업자용 공연정보 등록

- 사업자 로그인을 한다.
- 사업자가 공연정보를 가지고 공연정보 등록 요청한다.
- 해당 공연 정보로 등록된 공연이 있는지 확인한다.
    - 같은 시간 & 장소에 등록된 공연이 있다면 Exception 발생
    - 등록된 공연이 없으면 다음 과정 진행
- 공연 정보를 데이터베이스에 등록한다.
- 공연 등록 완료

### 사업자용 공연 정보 목록 조회

- 사업자 로그인을 한다
- 사업자가 본인이 등록한 모든 공연 정보 목록 조회를 요청한다.
    - 사업자일 경우 조회 성공
    - 사업자가 아닐경우 권한 Exception 발생

### 사업자용 공연 정보 상세 조회

- 사업자 로그인을 한다.
- 사업자가 특정 공연 정보 조회를 요청한다.
    - 사업자일 경우 조회 성공
    - 사업자가 아닐경우 권한 Exception 발생

### 사업자용 공연 정보 수정

- 사업자 로그인을 한다.
- 해당 공연 사업자가 본인이 등록한 공연정보 목록을 조회 한다. (공연 정보 목록 조회 API)
- 수정하고 싶은 공연정보를 선택한다.
    - 해당 공연 사업자가 공연 상세 정보를 조회한다. (공연 정보 상세 조회 API)
- 사업자가 수정하고 싶은 항목을 수정 요청한다. (공연 정보 수정 API)
    - 수정하고자 하는 정보를 가지고 공연 정보 수정을 요청한다.
    - 수정하고자 하는 공연이 본인이 등록한 공연인지 체크한다.
    - 수정하고자 하는 공연의 장소 및 시간이 변경될경우, 해당 장소 및 시간에 공연이 가능한지 체크한다.
    - 수정이 불가능한 정보를 수정요청했는지 체크한다.
        - 예매 시작시간 이후로는 수정이 불가능
    - 수정된 공연 정보를 데이터베이스에 update한다.
- 수정 완료

### 사업자용 공연 취소

- 사업자 로그인을 한다.
- 해당 공연 사업자가 공연정보 목록을 조회 한다.
- 취소하고 싶은 공연정보를 선택한다.
    - 해당 공연 사업자가 공연 상세 정보를 조회한다.
- 공연 취소를 한다.
    - 공연 취소 사유를 가지고 공연 취소 요청을 한다.
    - 해당 공연에 예매한 사용자들에게 공연이 취소되었음을 공지한다. (Notification - log만 남기기)
    - 취소된 공연 정보를 데이터베이스에 update한다.
- 취소 완료

### 사용자용 공연 정보 목록 조회

- 예매가 가능한 모든 공연 정보 목록을 조회한다.
    - 필터 및 정렬을 활용한다.
    - 필터 - 공연 시간(between), 공연 카테고리, 공연 장소, 검색 (제목, 출연진)
    - 정렬 - 공연 시간, 예매 수

사용자 로그인을 필요로 하지 않는다.

### 사용자용 공연 정보 상세 조회

- 모든 공연 정보 목록 조회를 요청한다.
- 특정 공연 정보 상세 조회를 요청한다.
- 선택한 공연정보 상세를 본다.

사용자 로그인을 필요로 하지 않는다.

### 사용자용 베스트 공연 목록 조회 (러닝타임이 짧은 순)

- 사용자 로그인을 한다.
- 현재 예매 가능한 모든 공연 목록 조회를 요청한다.
    - 조회된 공연 목록을 러닝타임이 짧은 순서대로 정렬한다.

### 사용자용 기타 특징있는 공연 목록 조회 (필수 X)

- 사용자 로그인을 한다.
- 현재 예매 가능한 모든 공연 목록 조회를 요청한다.
    - 조회된 공연 목록을 카테고리, 지역 별로 필터링해서 보여준다.

### 사업자용 예매 좌석 목록 조회

- 사업자 로그인을 한다.
- 본인이 등록한 모든 공연 정보 목록 조회를 요청한다.
- 확인하고 싶은 공연정보를 목록에서 선택해서 상세 조회를 요청한다.
- 해당 공연 정보를 가지고 해당하는 예매된 모든 좌석 정보 목록 조회를 요청한다.

### 사업자용 예매 좌석 정보 조회

- 사업자 로그인을 한다.
- 본인이 등록한 모든 공연 정보 목록 조회를 요청한다.
- 확인하고 싶은 공연정보를 목록에서 선택해서 상세 조회를 요청한다.
- 해당 공연 정보를 가지고 해당하는 모든 좌석 정보 목록 조회를 요청한다.
- 조회한 모든 좌석 정보 목록중 특정 좌석을 선택하여 상세 정보를 요청한다.

### 사업자용 예매 좌석 등록?

- VIP 용과 같은 경우 애초에 예매 좌석으로 등록하지 않고, 사업자가 자리로 안내해주면 되니 사업자용 등록기능은 필요없음

### 사용자용 좌석 예매 (좌석 선택)

- 예매 가능한 모든 공연 목록 조회를 요청한다.
- 예매하길 원하는 특정 공연을 선택하여 공연 상세 정보 조회를 요청한다.
- 특정 공연의 모든 좌석 목록 조회를 요청한다. (예매하기)
    - 로그인이 되어있지 않으면 로그인을 요청한다.
    - 예매가 가능한것, 불가능한 것을 표시한다.
- 모든 좌석 목록중 예매가 가능한 좌석 중에 예매할 좌석 선택한다.
    - 이미 좌석이 예매 또는 선택된 경우 이미 선택된 좌석입니다.
    - 공연 정보와 사용자 정보를 가지고 사용자가 예매 가능한 공연인지 체크한다.
        - 관람 가능한 나이인지?
    - 선택이 가능한 좌석이면 다음(결제) 로 이동
        - 좌석 도메인이랑 연결된건데, 다음으로 이동하면서 데이터베이스 row등록?

### 사용자용 예매 좌석 정보 조회

- 사용자 로그인을 한다.
- 본인이 예매한 공연 정보 목록 조회를 요청한다.
- 선택한 공연의 예매 좌석 상세 정보 조회를 요청한다.

### 사용자용 예매 정보 수정

- 사용자 로그인을 한다.
- 본인이 예매한 공연 정보 목록 조회를 요청한다.
- 선택한 공연의 예매 상세 정보 조회를 요청한다.
- 수정하고자 하는 정보를 가지고 예매 정보 수정을 요청한다.
    - 수정가능한 정보들만 수정을 요청할 수 있다.
    - 데이터베이스 update한다.

- 예매 좌석 취소후 다시 예매 해야함?? 아니면 자리 수정 가능한거임???
    - 좌석 변경인 경우, 취소후 다시 예매
    - 현재 명시된 좌석 정보 수정의 경우, 정보만 수정할 수 있다.
        - 티켓을 받을 배송지, 현장발권 여부(몇일 전까지만 가능한지)
        - 이미 배송이 되었는지 체크가 필요하다.

### 사용자용 좌석 예매 취소

- 사용자 로그인을 한다.
- 본인이 예매한 공연 정보 목록 조회를 요청한다.
- 선택한 공연의 예매 상세 정보 조회를 요청한다.
- 본인이 예매한 좌석의 취소를 요청한다.
    - 본인이 예매한 좌석인지 체크한다.
    - 공연 시작시간 몇일 전인지 체크한다.
    - 결제한 내역을 취소한다.
        - 기존 결제내역을 delete하거나, row를 제거하는게 아니다.
        - 새로운 결제 내역을 등록하는데, 기존 결제내역의 금액만큼 -해준다.
        - 쿠폰을 사용한 결제였으면, 쿠폰을 돌려준다. (쿠폰의 유효기간은 그대로다.)
            - 쿠폰은 사용여부 Column을 update한다.

### 좌석 예매 결제

사용자의 좌석 예매로부터 넘어오는 페이지에서 요청받는 API

- 결제에 필요한 정보(사용자 정보, 공연 정보 포함)들을 가지고 결제를 요청한다.
    - 공연 정보와 사용자 정보를 비교하여 사용자가 예매가능한 공연인지 체크한다.
    - 사용 가능한 쿠폰이 있는지 확인한다.
    - 쿠폰이 적용된 금액으로 결제를 요청한다.

### 좌석 예매 자동 취소

- 예매된 모든 좌석 목록을 조회한다.
- 예매된 모든 좌석중 결제되지 않은 좌석인데, 예매 시간으로부터 5분이 지났으면 취소한다.

- Batch와 같은 스케쥴링으로 주기적으로 호출한다.

### 좌석 예매 결제 취소

사용자의 좌석 예매 취소로부터 넘어오는 페이지에서 요청받는 API

- 결제 취소에 필요한 정보(사용자 정보, 공연 정보 포함)들을 가지고 결제 취소를 요청한다.
    - 공연 시작일로부터 3일전인지 체크한다. (취소 불가능)
    - 사용한 쿠폰이 있는지 확인한다.
    - 쿠폰으로 할인받은 금액을 제외한 실 결제 금액을 - 결제한다.
    - 쿠폰을 돌려준다. (유효기간 그대로)

### 쿠폰 발급 (사업자)

- 사업자 로그인을 한다.
- 본인이 등록한 모든 공연 목록 조회를 요청한다.
- 쿠폰 발급을 원하는 특정 공연을 선택하여 상세 정보 조회를 요청한다.
- 해당 공연에 대한 쿠폰을 발급한다.
    - 쿠폰을 발급하기 위해 필요한 정보를 가지고 요청한다.
        - 공연정보, 쿠폰발급수, 쿠폰의 할인타입 및 금액 등
    - 쿠폰의 할인 금액은 공연의 금액을 넘을 수 없다.
    - 발급된 쿠폰 목록을 사업자에게 제공한다.

### 쿠폰 목록 조회 (사업자)

- 사업자 로그인을 한다.
- 본인이 등록한 모든 공연 목록 조회를 요청한다.
- 특정 공연을 선택하여 상세 정보 조회를 요청한다.
- 해당 공연에서 발급된 모든 쿠폰 목록 조회를 요청한다.

### 회원 가입

- 사용자가 회원정보를 가지고 회원가입을 요청한다.
- 해당 회원 정보로 등록된 회원이 있는지 확인한다.
    - 등록된 회원이 있다면 Exception 발생
    - 등록된 회원이 없으면 다음 과정 진행
- 회원 정보를 데이터베이스에 등록한다.
- 회원가입 완료

### 회원 정보 조회

- 로그인을 한다.
- 사용자가 본인 상세 정보 조회 요청한다.

### 회원 정보 수정

- 로그인을 한다.
- 사용자가 본인 상세 정보 조회 요청한다.
- 사용자가 수정하고 싶은 항목을 수정 요청한다.
- 수정 완료

### 회원 탈퇴

- 로그인을 한다.
- 회원 탈퇴 요청
